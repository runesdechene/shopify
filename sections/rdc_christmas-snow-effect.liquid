{% if section.settings.enable_snow %}
<!-- Effet de neige élégant pour Noël -->
<div id="snow-container-{{ section.id }}"></div>

<style>
  #snow-container-{{ section.id }} {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: {{ section.settings.z_index }};
    overflow: hidden;
  }

  #snow-container-{{ section.id }} .snowflake {
    position: fixed;
    top: -50px;
    color: {{ section.settings.snow_color }};
    font-size: 1em;
    font-family: Arial, sans-serif;
    text-shadow: 0 0 5px {{ section.settings.snow_color }}cc;
    pointer-events: none;
    user-select: none;
    animation: snowfall linear infinite;
  }

  @keyframes snowfall {
    0% {
      transform: translateY(0) translateX(0);
      opacity: {{ section.settings.snow_opacity | divided_by: 100.0 }};
    }
    100% {
      transform: translateY(calc(100vh + 100px)) translateX(var(--drift));
      opacity: {{ section.settings.snow_opacity | divided_by: 100.0 }};
    }
  }

  /* Responsive */
  @media (max-width: 768px) {
    #snow-container-{{ section.id }} .snowflake {
      font-size: 0.8em;
    }
  }
</style>

<script>
  (function() {
    const container = document.getElementById('snow-container-{{ section.id }}');
    if (!container) return;

    const snowflakeCount = 80;
    const snowflakes = ['❄', '❅', '❆'];

    // Créer 80 flocons
    for (let i = 0; i < snowflakeCount; i++) {
      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');
      
      // Symbole aléatoire
      snowflake.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
      
      // Position horizontale aléatoire
      const leftPosition = Math.random() * 100;
      snowflake.style.left = leftPosition + '%';
      
      // Taille aléatoire
      const size = 0.5 + Math.random() * 1;
      snowflake.style.fontSize = size + 'em';
      
      // Durée de chute aléatoire (10-25 secondes)
      const duration = 10 + Math.random() * 15;
      snowflake.style.animationDuration = duration + 's';
      
      // Délai aléatoire pour étaler les départs (0 à 10 secondes)
      const delay = Math.random() * 10;
      snowflake.style.animationDelay = delay + 's';
      
      // Dérive horizontale aléatoire (mouvement gauche-droite)
      const drift = -50 + Math.random() * 100; // -50px à +50px
      snowflake.style.setProperty('--drift', drift + 'px');
      
      container.appendChild(snowflake);
    }

    // Nettoyer lors du changement de page
    if (window.Shopify && window.Shopify.designMode) {
      document.addEventListener('shopify:section:unload', function(event) {
        if (event.detail.sectionId === '{{ section.id }}') {
          container.innerHTML = '';
        }
      });
    }
  })();
</script>
{% endif %}

{% schema %}
{
  "name": "❄️ Effet Neige de Noël",
  "tag": "section",
  "class": "christmas-snow-section",
  "settings": [
    {
      "type": "header",
      "content": "Activation"
    },
    {
      "type": "checkbox",
      "id": "enable_snow",
      "label": "Activer l'effet de neige",
      "default": true,
      "info": "Désactivez après les fêtes pour retirer l'effet"
    },
    {
      "type": "header",
      "content": "Apparence"
    },
    {
      "type": "color",
      "id": "snow_color",
      "label": "Couleur des flocons",
      "default": "#ffffff",
      "info": "Blanc par défaut, mais vous pouvez choisir une autre couleur"
    },
    {
      "type": "range",
      "id": "snow_opacity",
      "min": 20,
      "max": 100,
      "step": 10,
      "unit": "%",
      "label": "Opacité des flocons",
      "default": 80,
      "info": "Réduisez pour un effet plus subtil"
    },
    {
      "type": "range",
      "id": "z_index",
      "min": 1000,
      "max": 9900,
      "step": 100,
      "label": "Z-index (profondeur)",
      "default": 9900,
      "info": "Augmentez si les flocons passent derrière d'autres éléments"
    },
    {
      "type": "header",
      "content": "Quantité de neige"
    },
    {
      "type": "range",
      "id": "snow_count_desktop",
      "min": 10,
      "max": 100,
      "step": 5,
      "label": "Nombre de flocons (Desktop)",
      "default": 50,
      "info": "Plus il y en a, plus l'effet est intense"
    },
    {
      "type": "range",
      "id": "snow_count_mobile",
      "min": 10,
      "max": 60,
      "step": 5,
      "label": "Nombre de flocons (Mobile)",
      "default": 30,
      "info": "Moins de flocons sur mobile pour de meilleures performances"
    },
    {
      "type": "header",
      "content": "Taille des flocons"
    },
    {
      "type": "range",
      "id": "min_size",
      "min": 3,
      "max": 10,
      "step": 1,
      "label": "Taille minimale",
      "default": 5,
      "info": "Valeur x 0.1em (5 = 0.5em)"
    },
    {
      "type": "range",
      "id": "max_size",
      "min": 10,
      "max": 30,
      "step": 1,
      "label": "Taille maximale",
      "default": 15,
      "info": "Valeur x 0.1em (15 = 1.5em)"
    },
    {
      "type": "header",
      "content": "Vitesse de chute"
    },
    {
      "type": "range",
      "id": "min_duration",
      "min": 5,
      "max": 15,
      "step": 1,
      "unit": "s",
      "label": "Durée minimale de chute",
      "default": 10,
      "info": "Temps minimum pour traverser l'écran"
    },
    {
      "type": "range",
      "id": "max_duration",
      "min": 15,
      "max": 30,
      "step": 1,
      "unit": "s",
      "label": "Durée maximale de chute",
      "default": 20,
      "info": "Temps maximum pour traverser l'écran"
    }
  ],
  "presets": [
    {
      "name": "❄️ Effet Neige de Noël"
    }
  ]
}
{% endschema %}

{%- liquid
  assign media_count = product.media.size
  assign desktop_visible = section.settings.desktop_visible_slides
  assign mobile_visible = section.settings.mobile_visible_slides
  assign bg_color = section.settings.background_color
  assign border_radius = section.settings.border_radius
-%}

<section
  id="RdcProductCarousel-{{ section.id }}"
  class="rdc-product-carousel section-padding"
  data-section="{{ section.id }}"
>
  {{ 'section-main-product.css' | asset_url | stylesheet_tag }}
  
  <style>
    .rdc-carousel-{{ section.id }} {
      width: 100%;
      overflow: hidden;
      position: relative;
    }
    
    .rdc-carousel-{{ section.id }} .splide__track {
      overflow: visible;
    }
    
    .rdc-carousel-{{ section.id }} .splide__list {
      overflow: visible;
    }
    
    .rdc-carousel-{{ section.id }} .splide__slide {
      opacity: 0.6;
      transition: opacity 0.4s ease;
    }
    
    .rdc-carousel-{{ section.id }} .splide__slide.is-prev,
    .rdc-carousel-{{ section.id }} .splide__slide.is-next {
      opacity: 0.9 !important;
    }
    
    .rdc-carousel-{{ section.id }} .splide__slide.is-active {
      opacity: 1 !important;
    }
    
    .rdc-carousel-{{ section.id }} .splide__slide .image-wrapper {
      background-color: {{ bg_color }};
      border-radius: {{ border_radius }}px;
      overflow: hidden;
      width: 100%;
      height: {{ section.settings.image_height_desktop }}px;
    }
    
    .rdc-carousel-{{ section.id }} .splide__slide img {
      width: 100%;
      height: 100%;
      object-fit: {{ section.settings.image_fit }};
      cursor: zoom-in;
      display: block;
    }
    
    .rdc-carousel-{{ section.id }} .splide__arrows {
      position: absolute;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      z-index: 10;
      padding: 0 20px;
    }
    
    .rdc-carousel-{{ section.id }} .splide__arrow {
      position: absolute;
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      pointer-events: all;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .rdc-carousel-{{ section.id }} .splide__arrow:hover {
      background: rgba(255, 255, 255, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: scale(1.05);
    }
    
    .rdc-carousel-{{ section.id }} .splide__arrow--prev {
      left: 0;
    }
    
    .rdc-carousel-{{ section.id }} .splide__arrow--next {
      right: 0;
    }
    
    .rdc-carousel-{{ section.id }} .splide__arrow svg {
      width: 20px;
      height: 20px;
      color: #000;
    }
    
    .rdc-carousel-{{ section.id }} .splide__arrow--prev svg {
      transform: rotate(180deg);
    }
    
    @media screen and (max-width: 767px) {
      .rdc-carousel-{{ section.id }} .splide__slide .image-wrapper {
        height: {{ section.settings.image_height_mobile }}px;
      }
      
      .rdc-carousel-{{ section.id }} .splide__arrow {
        width: 40px;
        height: 40px;
      }
      
      .rdc-carousel-{{ section.id }} .splide__arrows {
        padding: 0 10px;
      }
    }
  </style>

  <div class="rdc-carousel-{{ section.id }}">
    <div
      id="RdcCarousel-{{ section.id }}"
      class="splide"
      data-splide='{
        "type": "loop",
        "perPage": {{ desktop_visible }},
        "perMove": 1,
        "focus": "center",
        "gap": "{{ section.settings.gap_desktop }}px",
        "padding": { "left": "0", "right": "0" },
        "pagination": false,
        "arrows": true,
        "drag": true,
        "speed": 600,
        "easing": "cubic-bezier(0.25, 1, 0.5, 1)",
        "updateOnMove": true,
        "breakpoints": {
          "767": {
            "perPage": {{ mobile_visible }},
            "gap": "{{ section.settings.gap_mobile }}px",
            "focus": "center"
          }
        }
      }'
    >
      <div class="splide__track">
        <ul class="splide__list splide__gallery">
          {%- for media in product.media -%}
            {%- if media.media_type == 'image' -%}
              <li class="splide__slide product-media-zoom" data-media-id="{{ media.id }}">
                <div class="image-wrapper">
                  <a href="{{ media | image_url: width: 2000 }}" data-pswp-width="{{ media.width }}" data-pswp-height="{{ media.height }}">
                    {{
                      media
                      | image_url: width: 1200
                      | image_tag:
                        loading: 'lazy',
                        sizes: '(min-width: 768px) 33vw, 90vw',
                        widths: '300, 600, 900, 1200',
                        alt: media.alt | escape
                    }}
                  </a>
                </div>
              </li>
            {%- endif -%}
          {%- endfor -%}
        </ul>
      </div>

      <div class="splide__arrows">
        <button class="splide__arrow splide__arrow--prev" type="button" aria-label="Previous slide">
          {% render 'icon-arrow-right' %}
        </button>
        <button class="splide__arrow splide__arrow--next" type="button" aria-label="Next slide">
          {% render 'icon-arrow-right' %}
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const carouselElement = document.querySelector('#RdcCarousel-{{ section.id }}');
      if (carouselElement && typeof Splide !== 'undefined') {
        new Splide('#RdcCarousel-{{ section.id }}').mount();
      }
    });
  </script>
</section>

{% schema %}
{
  "name": "RDC Product Carousel",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Desktop Settings"
    },
    {
      "type": "range",
      "id": "desktop_visible_slides",
      "label": "Visible slides on desktop",
      "min": 3,
      "max": 7,
      "step": 1,
      "default": 5,
      "info": "Number of images visible at once on desktop"
    },
    {
      "type": "range",
      "id": "image_height_desktop",
      "label": "Image height (desktop)",
      "min": 300,
      "max": 800,
      "step": 50,
      "unit": "px",
      "default": 500
    },
    {
      "type": "range",
      "id": "gap_desktop",
      "label": "Gap between images (desktop)",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "range",
      "id": "mobile_visible_slides",
      "label": "Visible slides on mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 1,
      "info": "Number of images visible at once on mobile"
    },
    {
      "type": "range",
      "id": "image_height_mobile",
      "label": "Image height (mobile)",
      "min": 200,
      "max": 600,
      "step": 50,
      "unit": "px",
      "default": 400
    },
    {
      "type": "range",
      "id": "gap_mobile",
      "label": "Gap between images (mobile)",
      "min": 0,
      "max": 30,
      "step": 5,
      "unit": "px",
      "default": 10
    },
    {
      "type": "header",
      "content": "Image Settings"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Image fit",
      "options": [
        {
          "value": "cover",
          "label": "Cover (fill space)"
        },
        {
          "value": "contain",
          "label": "Contain (show full image)"
        },
        {
          "value": "fill",
          "label": "Fill (stretch)"
        }
      ],
      "default": "cover"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#EEEDE6",
      "info": "Background color for image containers"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border radius",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 10,
      "info": "Rounded corners for images"
    }
  ],
  "presets": [
    {
      "name": "RDC Product Carousel"
    }
  ]
}
{% endschema %}

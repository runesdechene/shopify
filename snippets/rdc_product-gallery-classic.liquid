{%- comment -%}
  RDC Classic Product Gallery
  
  Clean, classic product gallery with main image on top and thumbnail navigation below.
  Similar to the reference design provided.
{%- endcomment -%}

{%- liquid
  assign media_count = product.media.size
  assign featured_media = product.selected_or_first_available_variant.featured_media | default: product.featured_media
-%}

<style>
  .rdc-classic-gallery {
    width: 100%;
  }

  .rdc-classic-gallery__main {
    width: 100%;
    margin-bottom: 1.5rem;
    background-color: #EEEDE6;
    border-radius: 8px;
    overflow: hidden;
  }

  .rdc-classic-gallery__main-image {
    display: none;
  }

  .rdc-classic-gallery__main-image.active {
    display: block;
  }

  .rdc-classic-gallery__main-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .rdc-classic-gallery__thumbnails {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .rdc-classic-gallery__thumbnail {
    aspect-ratio: 1;
    background-color: #EEEDE6;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.3s ease;
    border: 2px solid transparent;
  }

  .rdc-classic-gallery__thumbnail:hover {
    opacity: 0.9;
  }

  .rdc-classic-gallery__thumbnail.active {
    opacity: 1;
    border-color: #534f4f;
  }

  .rdc-classic-gallery__thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  @media (max-width: 767px) {
    .rdc-classic-gallery__thumbnails {
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
    }
  }

  @media (max-width: 480px) {
    .rdc-classic-gallery__thumbnails {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>

<div class="rdc-classic-gallery" id="RdcClassicGallery-{{ section.id }}">
  {%- comment -%} Main image area {%- endcomment -%}
  <div class="rdc-classic-gallery__main">
    {%- for media in product.media -%}
      {%- if media.media_type == 'image' -%}
        <div 
          class="rdc-classic-gallery__main-image {% if media.id == featured_media.id %}active{% endif %}"
          data-media-id="{{ media.id }}"
          data-index="{{ forloop.index0 }}"
        >
          {{
            media
            | image_url: width: 1200
            | image_tag:
              loading: 'eager',
              sizes: '(min-width: 768px) 50vw, 100vw',
              widths: '600, 900, 1200, 1500',
              alt: media.alt | escape
          }}
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>

  {%- comment -%} Thumbnail navigation {%- endcomment -%}
  {%- if media_count > 1 -%}
    <div class="rdc-classic-gallery__thumbnails">
      {%- for media in product.media -%}
        {%- if media.media_type == 'image' -%}
          <div 
            class="rdc-classic-gallery__thumbnail {% if media.id == featured_media.id %}active{% endif %}"
            data-media-id="{{ media.id }}"
            data-index="{{ forloop.index0 }}"
          >
            {{
              media
              | image_url: width: 200
              | image_tag:
                loading: 'lazy',
                alt: media.alt | escape
            }}
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  {%- endif -%}
</div>

<script>
  (function() {
    function initClassicGallery() {
      const gallery = document.getElementById('RdcClassicGallery-{{ section.id }}');
      if (!gallery) return;

      const thumbnails = Array.from(gallery.querySelectorAll('.rdc-classic-gallery__thumbnail'));
      const mainImages = Array.from(gallery.querySelectorAll('.rdc-classic-gallery__main-image'));

      function setActiveImage(index) {
        thumbnails.forEach((thumb, i) => {
          thumb.classList.toggle('active', i === index);
        });

        mainImages.forEach((img, i) => {
          img.classList.toggle('active', i === index);
        });
      }

      thumbnails.forEach((thumbnail, index) => {
        thumbnail.addEventListener('click', function(e) {
          e.preventDefault();
          setActiveImage(index);
        });
      });

      // Listen for variant changes
      document.addEventListener('variant:changed', function(event) {
        if (event.detail && event.detail.variant && event.detail.variant.featured_media) {
          const mediaId = event.detail.variant.featured_media.id;
          const targetIndex = mainImages.findIndex(img => 
            img.dataset.mediaId == mediaId
          );
          if (targetIndex !== -1) {
            setActiveImage(targetIndex);
          }
        }
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initClassicGallery);
    } else {
      initClassicGallery();
    }
  })();
</script>

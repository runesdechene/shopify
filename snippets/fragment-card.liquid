{%- doc -%}
  This snippet is used to render a fragment card.
  To be used inside a block to inherit the block object settings.

  @param {string} card_image - The image to display in the fragment card
  @param {string} children - The content to render inside the fragment card
  @param {object} fragment - The fragment metaobject to render the card for
  @param {object} block - The block object
  @param {object} section - The section object

  @example
  {% render 'fragment-card',
    card_image: card_image,
    children: children,
    block: block,
    fragment: fragment,
    section: section
  %}
{%- enddoc -%}

{% style %}
  {% if request.visual_preview_mode %}
    .fragment-card {
      min-width: 250px;
    }
  {% endif %}
{% endstyle %}

{% liquid
  assign onboarding = false
  assign block_settings = block.settings

  if fragment == blank
    assign onboarding = true
  endif
  
  # Get the first linked product for the card link
  assign card_url = '#'
  if fragment != blank
    assign linked_products = fragment.produits.value
    if linked_products != blank and linked_products.size > 0
      assign first_product = linked_products.first
      assign card_url = first_product.url
    endif
  endif
%}

<div
  class="
    fragment-card
    border-style
    {% if block_settings.placement == 'on_image' %}fragment-card--image-bg{% endif %}
    {% if block_settings.inherit_color_scheme == false %} color-{{ block_settings.color_scheme }}{% endif %}
  "
  data-block-id="{{ block.id }}"
  {% if onboarding %}
    data-placeholder="true"
  {% endif %}
  style="
    {% render 'border-override', settings: block_settings %}
    --horizontal-alignment: {{ block_settings.horizontal_alignment }};
    --vertical-alignment: {{ block_settings.vertical_alignment }};
    --background-overlay-color: {{ block_settings.overlay_color }};
    --gap: {{ block_settings.fragment_card_gap }}px;
  "
  {{- block.shopify_attributes -}}
>
  <a
    class="fragment-card__link"
    {% unless onboarding %}
      href="{{ card_url }}"
    {% endunless %}
  >
    <span class="visually-hidden">
      {% if fragment != blank %}
        {{ fragment.system.title }}
      {% else %}
        {{ 'placeholders.fragment_title' | t }}
      {% endif %}
    </span>
  </a>
  <div class="fragment-card__inner">
    {{ card_image }}
    <div class="fragment-card__content layout-panel-flex--column">
      {{ children }}
    </div>
  </div>
</div>

{% stylesheet %}
  .fragment-card {
    --fixed-card-height: var(--height-small);
    flex: 1 1 var(--card-width-small);
    position: relative;
  }

  .fragment-card > svg {
    height: 100%;
    width: 100%;
    aspect-ratio: var(--ratio);
  }

  .fragment-card--image-bg .fragment-card__inner {
    height: 100%;
  }

  .fragment-card__inner {
    gap: var(--gap);
  }
  
  .fragment-card__inner a,
  .fragment-card__inner button {
    pointer-events: auto;
  }

  .shopify-design-mode .fragment-card__content * {
    pointer-events: auto;
  }

  .fragment-card__content {
    max-width: 100%;
    --flex-wrap: wrap;
  }

  .fragment-card.fragment-card--image-bg {
    aspect-ratio: var(--ratio);
  }

  .fragment-card.fragment-card--image-bg .fragment-card__content {
    padding: var(--padding-lg);
  }

  .fragment-card__link {
    position: absolute;
    inset: 0;
    z-index: 1;
  }

  .fragment-card__image {
    position: relative;
  }

  .fragment-card__image .image-block__image {
    object-fit: cover;
    width: 100%;
    height: 100%;
    max-width: 100%;
  }

  .fragment-card--image-bg .fragment-card__image {
    position: absolute;
    width: 100%;
    height: 100%;
  }

  .fragment-card__image svg {
    height: 100%;
    width: 100%;
  }
{% endstylesheet %}

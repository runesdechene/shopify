{%- comment -%}
  RDC Aussi Disponible Block

  Displays related products that share the same illustration/relique type.
  Shows product type icons for each related product.

  Parameters:
  - block: The block settings
  - product: Current product object
  - section_id: Section ID for unique identifiers
{%- endcomment -%}
{% style %}
  .rdc-aussi-disponible__heading {
    text-align: left;
    font-size: 2.1rem;
  }

  .rdc-aussi-disponible__grid {
    justify-content: left;
  }
{% endstyle %}

{%- liquid
  assign metafield_namespace = block.settings.metafield_namespace | default: 'custom'
  assign metafield_key = block.settings.metafield_key | default: 'relique_type'
  assign current_relique = product.metafields[metafield_namespace][metafield_key]
-%}

{%- if product.metafields.custom.illustration != blank -%}
  {%- assign relique = product.metafields.custom.illustration.value -%}
  {%- assign relique_handle = relique.system.handle -%}
  {%- assign relique_name = relique.name -%}

  {%- comment -%} Sélectionner dynamiquement la collection basée sur le handle de l'illustration {%- endcomment -%}
  {%- assign dynamic_collection = collections[relique_handle] -%}

  {%- if dynamic_collection != blank -%}
    <div class="rdc-aussi-disponible" {{ block.shopify_attributes }}>
      {%- if block.settings.heading != blank -%}
        <h3 class="rdc-aussi-disponible__heading">{{ block.settings.heading }}</h3>
      {%- endif -%}

      <div class="rdc-aussi-disponible__grid">
        {%- for other_product in dynamic_collection.products -%}
          {%- if other_product.id != product.id -%}
            <div class="rdc-aussi-disponible__item">
              <a href="{{ other_product.url }}" class="rdc-aussi-disponible__link">
                {%- render 'rdc_product-type-icon', product_type: other_product.type -%}
                <span class="rdc-aussi-disponible__label">{{ other_product.type }}</span>
              </a>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  {%- endif -%}
{%- endif -%}
